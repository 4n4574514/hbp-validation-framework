<div ng-controller="ValTestDetailCtrl">

    <head>
        <nav class="navbar">
            <br>
            <div align=left> <a class="button-MC" ng-href="#/home" class="btn btn-primary">Home</a></div>
            <h1 align=center> Valitation Framework </h1>
        </nav>
    </head>
    <header>

        <nav class="navbar ">
            <h2 align=center> <b>Test: </b> {{ detail_test.tests[0].name}} (ID:{{ detail_test.tests[0].id }})</h2>


            <ul class="nav nav-perso">
                <li id="li_tab_description" class="active"><a class="nav-link" ng-click="toogleTabs('tab_description')" data-toggle="tab">Description</a></li>
                <li id="li_tab_version"><a class="nav-link" ng-click="toogleTabs('tab_version')" data-toggle="tab">Version</a></li>
                <li id="li_tab_results"><a class="nav-link" ng-click="toogleTabs('tab_results')" data-toggle="tab">Results</a></li>
                <li id="li_tab_comments"><a class="nav-link" ng-click="toogleTabs('tab_comments')" data-toggle="tab">Comments</a></li>
            </ul>
        </nav>
    </header>

    <body>

        <div class="control-group tab-pane" id="tab_description" style="display:block;" aria-expanded="true">
            <br>
            <h3 style="font-size:1.5em" align=center><b>Description of test {{ detail_test.tests[0].name }}</b></h3>
            <h4 style="font-size:1.2em" align=center><b>Authors: </b> {{ detail_test.tests[0].author }}</h4>
            <br>
            <div><a ng-click="toogleTabs( 'tab_edit_test')" class="button-MC">Edit</a></div>
            <br> <br>
            <h4 style="font-size:1em" align=left><b>Publication: </b> {{ detail_test.tests[0].publication }}</h4>
            <br>
            <table class="table-test-detail">
                <tbody>

                    <tr>
                        <td style="width: 25%"> <b>Test type: </b> {{ detail_test.tests[0].test_type }} </td>
                        <td style="width: 25%"> <b> Data type: </b> {{ detail_test.tests[0].data_type }} </td>
                        <td style="width: 25%"> <b> Data modality: </b> {{ detail_test.tests[0].data_modality }} </td>
                        <td style="width: 25%"> <b> Data location: </b>
                            <a href="url">{{ detail_test.tests[0].data_location }}</a>
                        </td>
                    </tr>
                    <tr>
                        <td> <b>Age: </b> {{ detail_test.tests[0].age }} </td>
                        <td> <b> Species: </b> {{ detail_test.tests[0].species }} </td>
                        <td> <b> Brain region: </b> {{ detail_test.tests[0].brain_region }} </td>
                        <td> <b> Cell type: </b> {{ detail_test.tests[0].cell_type }} </td>
                    </tr>
                </tbody>
            </table>
            <br>
            <table class="table-create">
                <thead>
                </thead>
                <tbody>
                    <tr>
                        <h4><b> Protocol: </b> </h4>
                        <div markdown="detail_test.tests[0].protocol"></div>
                        <br><br>
                    </tr>
                    <tr>
                        <div class="group" ng-repeat="img in model.model_images track by $index">
                            <figure>
                                <button ng-click='toggleSize($index, img)'><img id="image-$index"  ng-src="{{img.url}}" width="304" height="228"> </button>
                                <figcaption id=figcaptionDetail>{{img.caption}}</figcaption> <br>
                            </figure>
                        </div> &ensp;

                    </tr>
                </tbody>
            </table>
        </div>
    </body>



    <div class="control-group" id="tab_version" style="display:none;" aria-expanded="true">
        <br>
        <h3 style="font-size:1.5em" align=center><b>Code versions</b></h3><br>
        <div><a ng-click="toogleTabs( 'tab_new_version')" class="button-MC">New version</a></div>
        <br> <br>
        <div>
            <table class="table-create">
                <thead>
                    <tr>
                        <th style="width: 25%">Repository</th>
                        <th style="width: 25%">Version</th>
                        <th style="width: 25%">Test class</th>
                        <th style="width: 25%">Date/time</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat='code_version in detail_version_test.tests'>
                        <td style="width: 25%">{{ code_version.repository }}</td>
                        <td style="width: 25%">{{ code_version.version }}</td>
                        <td style="width: 25%"><code>{{ code_version.path }}</code></td>
                        <td style="width: 25%">{{ code_version.timestamp | date:'d MMMM yyyy, hh:mm' : 'UTC' }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!--<div class="control-group" id="tab_results" style="display:none;" aria-expanded="true">-->




    <div class="control-group" id="tab_new_version" style="display:none;" aria-expanded="true">
        <br>
        <h3 style="font-size:1.5em" align=center><b>New version</b></h3><br>
        <br>
        <form>
            <table>
                <tbody>
                    <br>
                    <tr>
                        <td>
                            <b>Version Name:</b>
                        </td>
                        <td>
                            <input type="text" ng-model="test_code.version" required/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Repository:</b>
                        </td>
                        <td>
                            <input type="url" ng-model="test_code.repository" required/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Test class:</b>
                        </td>
                        <td>
                            <input type=text rows="5" cols="50" ng-model="test_code.path" required>
                        </td>
                    </tr>

                </tbody>
            </table>
            <br> <br>
            <div class="navbar navbar-form">
                <button type="submit" class="btn btn-primary" ng-click=saveVersion()>Save</button>
            </div>
        </form>
    </div>


    <div class="control-group" id="tab_edit_test" style="display:none;" aria-expanded="true">
        <br>
        <h3 style="font-size:1.5em" align=center><b>Edit Test</b></h3><br>
        <br>
        <form>
            <table>
                <tbody>
                    <tr>
                        <td>
                            <table id="table-create">
                                <tbody>
                                    <tr>
                                        <td>
                                            <b>Name:</b>
                                        </td>
                                        <td>
                                            <input type="text" ng-model=" detail_test.tests[0].name" required/>
                                            <a class="glyphicon glyphicon-question-sign" aria-hidden="true" data-toggle="tooltip" data-placement="right" title="Example: THis is the name of my test"></a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>Author:</b>
                                        </td>
                                        <td>
                                            <input type="text" ng-model="detail_test.tests[0].author" required/>
                                            <a class="glyphicon glyphicon-question-sign" aria-hidden="true" data-toggle="tooltip" data-placement="right" title="Example: John Smith"></a>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td>
                                            <b>Publication:</b>
                                        </td>
                                        <td>
                                            <input type="text" ng-model="detail_test.tests[0].publication" required/>
                                            <a class="glyphicon glyphicon-question-sign" aria-hidden="true" data-toggle="tooltip" data-placement="right" title="Example: paper example ..."></a>
                                        </td>
                                    </tr>
                                    <tr>

                                        <td>
                                            <b>Protocol description:</b>
                                        </td>
                                        <td>
                                            <textarea class="scrollabletextbox" rows="10" cols="60" ng-model="detail_test.tests[0].protocol" required></textarea>
                                            <a class="glyphicon glyphicon-question-sign" aria-hidden="true" data-toggle="tooltip" data-placement="right" title="Example: protocole description example ..."></a><br /> <br>
                                        </td>

                                    </tr>
                                </tbody>
                            </table>
                        </td>
                        <td>
                            <table id="table-create">
                                <tbody>
                                    <tr>
                                        <td>
                                            <b>Species:</b>
                                        </td>
                                        <td>
                                            <select id="select-species" data-style="btn-primary" ng-model="detail_test.tests[0].species" required>
                                         <option ng-repeat="s in species" value="{{s}}">{{s}}</option>
                                    </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>Brain region: </b>
                                        </td>
                                        <td>
                                            <select id="select-brain-region" data-style="btn-primary" ng-model="detail_test.tests[0].brain_region" required>
                                         <option ng-repeat="br in brain_region" value="{{br}}">{{br}}</option>
                                    </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>Cell type:</b>
                                        </td>
                                        <td>
                                            <select id="select-cell-type" data-style="btn-primary" ng-model="detail_test.tests[0].cell_type" required>
                                         <option ng-repeat="ct in cell_type" value="{{ct}}">{{ct}}</option>
                                    </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>Age:</b>
                                        </td>
                                        <td>
                                            <input type="text" id="select-age" data-style="btn-primary" ng-model="detail_test.tests[0].age" required>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td>
                                            <b>Data modality:</b>
                                        </td>
                                        <td>

                                            <select id="select-data-modalities" data-style="btn-primary" ng-model="detail_test.tests[0].data_modality" required>
                                         <option ng-repeat="dm in data_modalities" value="{{dm}}">{{dm}}</option>
                                    </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>Test type:</b>
                                        </td>
                                        <td>
                                            <select id="select-test-type" data-style="btn-primary" ng-model="detail_test.tests[0].test_type" required>
                                         <option ng-repeat="tt in test_type" value="{{tt}}">{{tt}}</option>
                                    </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>Data type:</b>
                                        </td>
                                        <td>
                                            <input type="text" id="select-data_type" data-style="btn-primary" ng-model="detail_test.tests[0].data_type" required>
                                        </td>
                                    </tr>

                                </tbody>
                            </table>
                        </td>
                    </tr>
                </tbody>
            </table>
            <br> <br>
            <div class="navbar navbar-form">
                <button type="submit" class="btn btn-primary" ng-click=editTest()>Save</button>
            </div>
        </form>
    </div>


    <div class="control-group" id="tab_comments" style="display:none;" aria-expanded="true">
        <main class="comment" onsubmit="return false">

            <div class="panel-heading">
                <h3 class="panel-title" id="title-commment"> Comments </h3>
            </div>
            <div ng-repeat="comment in test_comments.comments" id='CommentToShow-{{comment.id}}'>

                <table class="table table-striped table-condensed">
                    <div class="comment">
                        <tbody>
                            <tr id="table-ticket-detail-comment">
                                <td width=200>
                                    <span class="glyphicon glyphicon-user"></span> {{ comment.author }}
                                </td>
                                <td width=1000>
                                </td>
                                <td width=300>
                                    {{ comment.creation_date | date:'d MMMM yyyy, hh:mm' : 'UTC' }}
                                </td>
                                <td width=50>

                                </td>
                            </tr>

                            <tr id="table-ticket-detail-comment-content">
                                <td width=200>
                                </td>
                                <td width=1000 id='editable-text-{{comment.id}}' contenteditable="false">
                                    <br/> {{ comment.text }}
                                </td>
                                <td width=300>
                                </td>
                                <td>
                                </td>
                            </tr>
                        </tbody>
                    </div>
                </table>

                <div id='panelForButtonSave-{{comment.id}}'></div>
            </div>
        </main>

        <main action="" class="commentForm" method="POST">
            <form class="comment-form" ng-submit="submit_comment()" ng-controller="ValTestDetailCtrl">
                <div class="comment-form-fields">
                    <div class="form-group form-group-editor">
                        <h4> Add a comment </h4>
                        <p id="CommentTextbox">
                            <textarea cols="40" id="txt_comment" name="txt_comment" ng-model="txt_comment" rows="10" required=""></textarea>
                        </p>
                        <p class="help-text">{{ form.text.errors }}</p>
                    </div>
                </div>
                <div class="navbar navbar-form">
                    <button type="submit" id="submit" value="Submit" class="btn btn-primary">Save</button>
                </div>
            </form>

        </main>
    </div>



    <div class="control-group" id="tab_results" style="visibility:hidden;" aria-expanded="true">

        <nvd3 options='graphic_options' data='graphic_data' id='chart svg'></nvd3>



        <br>
        <br>

        <table class="table" style="border-top: none;">

            <td>

                <table id="model_table" class="table">

                    <h3 align=center> Models </h3>

                    <thead>
                        <th>Results storage</th>
                        <th>Result</th>
                        <th>Passed</th>
                        <th>Time</th>
                        <th>Platform</th>
                        <th>Project</th>
                    </thead>

                    <tbody>

                        <tr class=tr-clickable id="" ng-repeat="result in result_focussed" ng-click="goToDetailView(model)">
                            <td>{{ result.results_storage }}</td>
                            <td>{{ result.result }}</td>
                            <td>{{ result.passed }}</td>
                            <td>{{ result.timestamp }}</td>
                            <td>{{ result.platform }}</td>
                            <td>{{ result.project }}</td>

                        </tr>
                    </tbody>
                </table>
            </td>

        </table>
    </div>
</div>